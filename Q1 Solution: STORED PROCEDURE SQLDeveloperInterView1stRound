-- Table 1: DEPARTMENT
CREATE TABLE DEPARTMENT (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    NAME VARCHAR(225) NOT NULL UNIQUE
);

-- Table 2: DESIGNATION
CREATE TABLE DESIGNATION (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    NAME VARCHAR(255) NOT NULL UNIQUE
);


-- Table 3: EMPLOYEE
CREATE TABLE EMPLOYEE (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    EMP_CODE VARCHAR(255) NOT NULL UNIQUE,
    EMP_NAME VARCHAR(255),
    ADDRESS VARCHAR(255),
    MOBILE_NO VARCHAR(10),
    DEPT_ID INT,
    DESIG_ID INT,
    FOREIGN KEY (DEPT_ID) REFERENCES DEPARTMENT(ID),
    FOREIGN KEY (DESIG_ID) REFERENCES DESIGNATION(ID)
);


CREATE PROCEDURE EMPLOYEE_COMMIT
    @EMP_CODE VARCHAR(255),
    @EMP_NAME VARCHAR(255),
    @ADDRESS VARCHAR(255),
    @MOBILE_NO VARCHAR(10),
    @DEPARTMENT_NAME VARCHAR(225),
    @DESIGNATION_NAME VARCHAR(255)
AS
BEGIN
    SET NOCOUNT ON;

    DECLARE @DESIG_ID INT;
    DECLARE @DEPT_ID INT;

    -- Step 1: Check DESIGNATION
    SELECT @DESIG_ID = ID 
    FROM DESIGNATION 
    WHERE NAME = @DESIGNATION_NAME;

    IF @DESIG_ID IS NULL
    BEGIN
        INSERT INTO DESIGNATION (NAME)
        VALUES (@DESIGNATION_NAME);

        SET @DESIG_ID = SCOPE_IDENTITY();
    END

    -- Step 2: Check DEPARTMENT
    SELECT @DEPT_ID = ID 
    FROM DEPARTMENT 
    WHERE NAME = @DEPARTMENT_NAME;

    IF @DEPT_ID IS NULL
    BEGIN
        INSERT INTO DEPARTMENT (NAME)
        VALUES (@DEPARTMENT_NAME);

        SET @DEPT_ID = SCOPE_IDENTITY();
    END

    -- Step 3: Upsert EMPLOYEE
    IF EXISTS (SELECT 1 FROM EMPLOYEE WHERE EMP_CODE = @EMP_CODE)
    BEGIN
        UPDATE EMPLOYEE
        SET 
            EMP_NAME = @EMP_NAME,
            ADDRESS = @ADDRESS,
            MOBILE_NO = @MOBILE_NO,
            DEPT_ID = @DEPT_ID,
            DESIG_ID = @DESIG_ID
        WHERE EMP_CODE = @EMP_CODE;
    END
    ELSE
    BEGIN
        INSERT INTO EMPLOYEE
        (EMP_CODE, EMP_NAME, ADDRESS, MOBILE_NO, DEPT_ID, DESIG_ID)
        VALUES
        (@EMP_CODE, @EMP_NAME, @ADDRESS, @MOBILE_NO, @DEPT_ID, @DESIG_ID);
    END
END;




Now we are in a position to execute the STORED PROCEDURE
-- It will Insert a new employee data into the employee table, but before that it will creating a new designation id and department id
EXEC EMPLOYEE_COMMIT
    @EMP_CODE = 'EMP1001',
    @EMP_NAME = 'Jwala Raj',
    @ADDRESS = 'Patna, Bihar',
    @MOBILE_NO = '9353763838',
    @DEPARTMENT_NAME = 'IT',
    @DESIGNATION_NAME = 'Business Analyst';

-- It will update the mobile number
	EXEC EMPLOYEE_COMMIT
    @EMP_CODE = 'EMP1001',
    @EMP_NAME = 'Jwala Raj',
    @ADDRESS = 'Patna, Bihar',
    @MOBILE_NO = '9905305530',
    @DEPARTMENT_NAME = 'IT',
    @DESIGNATION_NAME = 'Business Analyst';
